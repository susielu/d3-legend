<!DOCTYPE html>
<meta charset="utf-8">
<style>
body {
  margin: 0;
  overflow: hidden;
}

svg {
  font: 10px sans-serif;
}

.caption {
  font-weight: bold;
}

.key path {
  display: none;
}

.key line {
  stroke: #000;
  shape-rendering: crispEdges;
}

.q0-9 {
  fill: rgb(247, 251, 255);
}

.q1-9 {
  fill: rgb(222, 235, 247);
}

.q2-9 {
  fill: rgb(198, 219, 239);
}

.q3-9 {
  fill: rgb(158, 202, 225);
}

.q4-9 {
  fill: rgb(107, 174, 214);
}

.q5-9 {
  fill: rgb(66, 146, 198);
}

.q6-9 {
  fill: rgb(33, 113, 181);
}

.q7-9 {
  fill: rgb(8, 81, 156);
}

.q8-9 {
  fill: rgb(8, 48, 107);
}

</style>

<body>
  <svg id="legend">
      <g transform="translate(20,20)" class="legend"></g>
  </svg>
  <svg id="promiseLegend">
      <g transform="translate(20,20)" class="legend"></g>
  </svg>
</body>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script> -->
<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="../d3-legend.js"></script>
<script>
var thresholdScale = d3.scaleThreshold()
  .domain([0, 1000, 2500, 5000, 10000])
  .range(d3.range(6)
    .map(function(i) { return "q" + i + "-9" }));

var linear = d3.scaleLinear()
  .domain([0, 10])
  .range(["rgb(46, 73, 123)", "rgb(71, 187, 94)"]);

// ----legendHelpers.thresholdLabels----
const promiseHelper = function({
  i,
  genLength,
  generatedLabels,
  labelDelimiter
}) {

  //
  const promise =  Promise.resolve()
    .then(function(string) {
      return new Promise(function(resolve, reject) {
        setTimeout(function() {
          let res;
          if (i === 0) {
            const values = generatedLabels[i].split(` ${labelDelimiter} `);
            return resolve(`Less than ${values[1]}`);
          } else if (i === genLength - 1) {
            const values = generatedLabels[i].split(` ${labelDelimiter} `);
            return resolve(`${values[0]} or more`);
          }
          return resolve(generatedLabels[i]);
        }, 100);
      });
    });

  return promise;  
};

// ----legendHelpers.thresholdLabels----
const helper = function({
  i,
  genLength,
  generatedLabels,
  labelDelimiter
}) {

  if (i === 0) {
    const values = generatedLabels[i].split(` ${labelDelimiter} `);
    return `Less than ${values[1]}`;
  } else if (i === genLength - 1) {
    const values = generatedLabels[i].split(` ${labelDelimiter} `);
    return `${values[0]} or more`;
  }
  return generatedLabels[i];
};

const legend = d3.legendColor()
  .labelFormat(d3.format('.2f'))
  .title('Sync labels')
  .labels(helper)
  .useClass(true)
  .scale(thresholdScale);

const promiseLegend = d3.legendColor()
  .labelFormat(d3.format('.2f'))
  .title('Async labels (Promise)')
  .labels(promiseHelper)
  .useClass(true)
  .scale(thresholdScale);



d3.select('#legend .legend')
  .call(legend);

d3.select('#promiseLegend .legend')
  .call(promiseLegend);


</script>
